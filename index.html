<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>호텔 탈출 관리</title>

  <!-- ✅ CSS는 여기 -->
  <style>
body {
  background:#0f0f12;
  color:#eee;
  font-family:sans-serif;
  padding:16px;
}

button {
  margin:4px;
  padding:6px 10px;
  border-radius:6px;
  border:none;
  cursor:pointer;
}

button {
  background:#333;
  color:#eee;
}

button:hover {
  background:#555;
}

button.danger {
  background:#7a1f1f;
}

.floor {
  background:#1b1212;
  padding:10px;
  border-radius:10px;
  margin-top:12px;
}

.room {
  background:#222;
  padding:8px;
  border-radius:8px;
  margin-top:8px;
}

.item {
  font-size:14px;
}

.progress {
  height:10px;
  background:#333;
  border-radius:5px;
  overflow:hidden;
  margin-top:6px;
}

.progress-bar {
  height:100%;
  width:0%;
  background:#4caf50;
}

.progress-bar.done {
  background:#ff5252;
}
.tag-탈출 { color:#ff6b6b; }
.tag-치료 { color:#4dabf7; }
.tag-자유 { color:#51cf66; }
.tag-오염 { color:#c77dff; }
</style>
</head>
<body>
<h2>아이템 태그 필터</h2>
<div id="tagFilter">
  <button onclick="setFilter('all')">전체</button>
  <button onclick="setFilter('탈출')">탈출</button>
  <button onclick="setFilter('치료')">치료</button>
  <button onclick="setFilter('자유')">자유</button>
  <button onclick="setFilter('오염')">오염</button>
</div>

<hr>

<input id="floorInput" placeholder="층 이름">
<button onclick="addFloor()">층 추가</button>

<div id="floors"></div>
<!-- 상단 태그 필터 -->
<script>
/* =====================
   데이터 & 저장
===================== */
let floors = JSON.parse(localStorage.getItem('floors')) || [];
let currentFilter = 'all';

function save() {
  localStorage.setItem('floors', JSON.stringify(floors));
}

/* =====================
   층
===================== */
function addFloor() {
  const input = document.getElementById('floorInput'); // ← 핵심
  const name = input.value.trim();

  if (!name) {
    alert('층 이름');
    return;
  }

  const desc = prompt('층 설명 (테마)') || '';

  floors.push({
    name: name,
    desc: desc,
    rooms: []
  });

  input.value = ''; // 입력칸 비우기
  save();
  render();
}

function moveFloor(i, dir) {
  const t = i + dir;
  if (t < 0 || t >= floors.length) return;
  [floors[i], floors[t]] = [floors[t], floors[i]];
  save();
  render();
}

function removeFloor(i) {
  if (!confirm('층 삭제?')) return;
  floors.splice(i, 1);
  save();
  render();
}

function editFloor(fi) {
  const f = floors[fi];
  const name = prompt('층 이름 수정', f.name);
  if (!name) return;

  const desc = prompt('층 설명 수정', f.desc || '');
  f.name = name;
  f.desc = desc;

  save();
  render();
}

/* =====================
   방
===================== */
function addRoom(fi) {
  const name = prompt('공간 이름');
  if (!name) return;

  const desc = prompt('공간 설명');
  floors[fi].rooms.push({
    name,
    desc,
    open:true,
    items:[]
  });

  save();
  render();
}

function removeRoom(fi, ri) {
  if (!confirm('공간 삭제?')) return;
  floors[fi].rooms.splice(ri,1);
  save();
  render();
}

function editRoom(fi, ri) {
  const r = floors[fi].rooms[ri];
  const name = prompt('공간 이름 수정', r.name);
  if (!name) return;

  const desc = prompt('공간 설명 수정', r.desc || '');
  r.name = name;
  r.desc = desc;

  save();
  render();
}

function toggleRoom(fi, ri) {
  floors[fi].rooms[ri].open = !floors[fi].rooms[ri].open;
  save();
  render();
}

/* =====================
   아이템
===================== */
function addItem(fi, ri) {
  const text = prompt('아이템 내용');
  if (!text) return;

  const tag = prompt(
    '태그 번호 선택:\n1 탈출\n2 치료\n3 자유\n4 오염'
  );

  const map = {
    '1':'탈출',
    '2':'치료',
    '3':'자유',
    '4':'오염'
  };

  if (!map[tag]) return;

  floors[fi].rooms[ri].items.push({
    text,
    tag: map[tag],
    done:false
  });

  save();
  render();
}

function toggleItem(fi, ri, ii) {
  const item = floors[fi].rooms[ri].items[ii];
  item.done = !item.done;
  save();
  render();
}

/* =====================
   필터
===================== */
function setFilter(tag) {
  currentFilter = tag;
  render();
}

/* =====================
   렌더링
===================== */
function render() {
  const el = document.getElementById('floors');
  el.innerHTML = '';

  floors.forEach((f, fi) => {
    let floorHTML = `
      <div class="floor">
        <b>${f.name}</b>
<p style="font-size:12px;color:#aaa;">${f.desc || ''}</p>
        <button onclick="moveFloor(${fi},-1)">↑</button>
        <button onclick="moveFloor(${fi},1)">↓</button>
        <button onclick="removeFloor(${fi})">삭제</button>
        <button onclick="editFloor(${fi})">수정</button>
        <button onclick="addRoom(${fi})">공간 추가</button>
    `;

    f.rooms.forEach((r, ri) => {
      let items = r.items.filter(it =>
        currentFilter === 'all' || it.tag === currentFilter
      );

      let done = r.items.filter(i=>i.done).length;
      let total = r.items.length;
      let percent = total ? Math.round(done/total*100) : 0;

      floorHTML += `
        <div class="room">
          <b onclick="toggleRoom(${fi},${ri})">${r.name}</b>
<p style="font-size:12px;color:#aaa;">${r.desc||''}</p>
<button onclick="removeRoom(${fi},${ri})">방 삭제</button>
<button onclick="editRoom(${fi},${ri})">수정</button>
          (${percent}%)
          <div class="progress">
            <div class="progress-bar ${percent===100?'done':''}"
                 style="width:${percent}%"></div>
          </div>
          <button onclick="addItem(${fi},${ri})">아이템 추가</button>
      `;

      if (r.open) {
        items.forEach((it, ii) => {
          floorHTML += `
            <div class="item tag-${it.tag}">
              <input type="checkbox"
                ${it.done?'checked':''}
                onclick="toggleItem(${fi},${ri},${ii})">
              [${it.tag}] ${it.text}
            </div>
          `;
        });
      }

      floorHTML += `</div>`;
    });

    floorHTML += `</div>`;
    el.innerHTML += floorHTML;
  });
}

render();
</script>