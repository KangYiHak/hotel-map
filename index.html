<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ï°∞ÏÇ¨ ÏãúÌä∏</title>

<style>
:root{
  --bg:#0f0f12;
  --card:#1a1a1f;
  --text:#eee;
  --muted:#999;
  --accent:#ffcc66;
  --sub:#6a5acd;

  --escape:#ffcc66;
  --heal:#8fff8f;
  --free:#7dd3ff;
  --corrupt:#b28dff;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,sans-serif;
}

/* ---------- TAG FILTER ---------- */
#filterBar{
  position:sticky;
  top:0;
  z-index:100;
  background:#0c0c10;
  border-bottom:1px solid #222;
  padding:10px;
  display:flex;
  gap:6px;
  flex-wrap:wrap;
}
.filter-tag{
  background:#222;
  color:#ccc;
  padding:4px 8px;
  border-radius:12px;
  font-size:.7rem;
  cursor:pointer;
}
.filter-tag.active{
  background:var(--accent);
  color:#000;
}

/* ---------- HEADER ---------- */
header{
  padding:14px;
  text-align:center;
}
header h1{margin:0;font-size:1.2rem}

/* ---------- BUTTON ---------- */
button{
  background:var(--accent);
  border:none;
  border-radius:8px;
  padding:6px 10px;
  font-size:.75rem;
  cursor:pointer;
}
button.sub{background:var(--sub);color:#fff}
button.ghost{background:#222;color:#ccc}

/* ---------- LAYOUT ---------- */
main{
  max-width:900px;
  margin:0 auto;
  padding:16px;
}

/* ---------- FLOOR ---------- */
.floor{
  background:var(--card);
  border-radius:14px;
  margin-bottom:14px;
  overflow:hidden;
}
.floor-header{
  padding:14px;
  background:linear-gradient(135deg,#1a0f0f,var(--sub));
  cursor:pointer;
}
.floor-header h2{margin:0;font-size:1rem}
.floor-header p{margin:4px 0 0;font-size:.75rem;color:var(--muted)}

.floor-controls{
  display:flex;
  gap:6px;
  padding:10px 14px;
  flex-wrap:wrap;
}

.rooms{display:none;padding:0 14px 14px;}
.floor.open .rooms{display:block}

/* ---------- ROOM ---------- */
.room{
  background:#1b1212;
  border-radius:10px;
  padding:10px;
  margin-top:10px;
}
.room.locked{opacity:.6}
.room h3{margin:0;font-size:.85rem}
.room p{margin:4px 0 0;font-size:.7rem;color:var(--muted)}

.room-controls{
  display:flex;
  gap:6px;
  margin-top:8px;
  flex-wrap:wrap;
}

/* ---------- ITEM ---------- */
.item{
  display:flex;
  align-items:center;
  gap:6px;
  font-size:.7rem;
  margin-top:6px;
}
.item.done{
  opacity:.4;
  text-decoration:line-through;
}
.item span{cursor:pointer}

/* ---------- TAG ---------- */
.tag{
  display:inline-block;
  padding:2px 6px;
  border-radius:8px;
  font-size:.6rem;
}
.tag.escape{background:var(--escape);color:#000}
.tag.heal{background:var(--heal);color:#000}
.tag.free{background:var(--free);color:#000}
.tag.corrupt{background:var(--corrupt);color:#000}

/* ---------- POPUP ---------- */
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:200;
}
.popup-content{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  width:90%;
  max-width:420px;
}
.popup-content h3{margin-top:0}
.popup-content input,textarea,select{
  width:100%;
  background:#0f0f12;
  color:var(--text);
  border:1px solid #333;
  border-radius:6px;
  padding:6px;
  font-size:.75rem;
  margin-bottom:8px;
}
.close{
  float:right;
  cursor:pointer;
  color:var(--muted);
}

/* ---------- MOBILE ---------- */
@media(max-width:600px){
  button{width:100%}
  .floor-controls,.room-controls{flex-direction:column}
}
</style>
</head>

<body>

<div id="filterBar"></div>

<header>
  <h1>Ï°∞ÏÇ¨ ÏãúÌä∏</h1>
  <button onclick="addFloor()">Ï∏µ Ï∂îÍ∞Ä</button>
</header>

<main id="floors"></main>

<!-- ITEM POPUP -->
<div class="popup" id="popup">
  <div class="popup-content">
    <span class="close" onclick="closePopup()">‚úï</span>
    <h3 id="popupTitle"></h3>
    <div id="popupBody"></div>
  </div>
</div>

<script>
let floors = JSON.parse(localStorage.getItem('hotelData')) || [];
let activeTags=[];
let current=null;

const TAGS=['ÌÉàÏ∂ú','ÏπòÎ£å','ÏûêÏú†','Ïò§Ïóº'];
const TAG_CLASS={ÌÉàÏ∂ú:'escape',ÏπòÎ£å:'heal',ÏûêÏú†:'free',Ïò§Ïóº:'corrupt'};

function save(){
  localStorage.setItem('hotelData',JSON.stringify(floors));
}

/* ---------- FLOOR ---------- */
function addFloor(){
  floors.push({name:'ÏÉà Ï∏µ',desc:'',open:true,rooms:[]});
  save();render();
}
function editFloor(i){
  popup('Ï∏µ ÏàòÏ†ï',`
    <input id="fn" value="${floors[i].name}">
    <textarea id="fd">${floors[i].desc}</textarea>
    <button onclick="saveFloor(${i})">Ï†ÄÏû•</button>
  `);
}
function saveFloor(i){
  floors[i].name=fn.value;
  floors[i].desc=fd.value;
  closePopup();save();render();
}
function deleteFloor(i){
  if(confirm('Ï∏µ ÏÇ≠Ï†ú?')){
    floors.splice(i,1);save();render();
  }
}

/* ---------- ROOM ---------- */
function addRoom(fi){
  floors[fi].rooms.push({name:'ÏÉà Í≥µÍ∞Ñ',desc:'',locked:false,items:[]});
  save();render();
}
function editRoom(fi,ri){
  const r=floors[fi].rooms[ri];
  popup('Í≥µÍ∞Ñ ÏàòÏ†ï',`
    <input id="rn" value="${r.name}">
    <textarea id="rd">${r.desc}</textarea>
    <button onclick="saveRoom(${fi},${ri})">Ï†ÄÏû•</button>
  `);
}
function saveRoom(fi,ri){
  const r=floors[fi].rooms[ri];
  r.name=rn.value;
  r.desc=rd.value;
  closePopup();save();render();
}
function deleteRoom(fi,ri){
  if(confirm('Í≥µÍ∞Ñ ÏÇ≠Ï†ú?')){
    floors[fi].rooms.splice(ri,1);
    save();render();
  }
}

/* ---------- ITEM ---------- */
function addItem(fi,ri){
  current={fi,ri,ii:null};
  popup('ÏïÑÏù¥ÌÖú Ï∂îÍ∞Ä',itemForm());
}
function editItem(fi,ri,ii){
  current={fi,ri,ii};
  popup('ÏïÑÏù¥ÌÖú ÏàòÏ†ï',itemForm(floors[fi].rooms[ri].items[ii]));
}
function itemForm(it={}){
  return `
    <input id="inm" value="${it.name||''}" placeholder="ÏïÑÏù¥ÌÖú Ïù¥Î¶Ñ">
    <select id="itag">
      ${TAGS.map(t=>`<option ${it.tag===t?'selected':''}>${t}</option>`).join('')}
    </select>
    <textarea id="ip">${it.path||''}</textarea>
    <button onclick="saveItem()">Ï†ÄÏû•</button>
  `;
}
function saveItem(){
  const obj={
    name:inm.value,
    tag:itag.value,
    path:ip.value,
    done:false
  };
  const {fi,ri,ii}=current;
  if(ii===null) floors[fi].rooms[ri].items.push(obj);
  else floors[fi].rooms[ri].items[ii]=obj;
  closePopup();save();render();
}
function deleteItem(fi,ri,ii){
  floors[fi].rooms[ri].items.splice(ii,1);
  save();render();
}
function toggleItem(fi,ri,ii){
  const it = floors[fi].rooms[ri].items[ii];
  it.done = !it.done;
  save();
  render();
}

/* ---------- POPUP ---------- */
function popup(t,b){
  popupTitle.innerText=t;
  popupBody.innerHTML=b;
  popup.style.display='flex';
}
function closePopup(){popup.style.display='none'}

/* ---------- FILTER ---------- */
function toggleTag(t){
  activeTags.includes(t)
    ?activeTags=activeTags.filter(x=>x!==t)
    :activeTags.push(t);
  render();
}

/* ---------- RENDER ---------- */
function render(){
  const fe=document.getElementById('floors');
  fe.innerHTML='';
  const tags=new Set();

  floors.forEach(f=>f.rooms.forEach(r=>r.items.forEach(i=>tags.add(i.tag))));

  document.getElementById('filterBar').innerHTML=
    [...tags].map(t=>`
      <div class="filter-tag ${activeTags.includes(t)?'active':''}"
           onclick="toggleTag('${t}')">${t}</div>`).join('');

  floors.forEach((f,fi)=>{
    const d=document.createElement('div');
    d.className='floor'+(f.open?' open':'');
    d.innerHTML=`
      <div class="floor-header" onclick="f.open=!f.open;render()">
        <h2>${f.name}</h2><p>${f.desc}</p>
      </div>
      <div class="floor-controls">
        <button onclick="addRoom(${fi})">Í≥µÍ∞Ñ Ï∂îÍ∞Ä</button>
        <button onclick="editFloor(${fi})">ÏàòÏ†ï</button>
        <button class="sub" onclick="deleteFloor(${fi})">ÏÇ≠Ï†ú</button>
      </div>
      <div class="rooms">
        ${f.rooms.map((r,ri)=>`
          <div class="room">
            <h3>${r.name}</h3><p>${r.desc}</p>
            ${r.items.filter(i=>!activeTags.length||activeTags.includes(i.tag)).map((i,ii)=>`
              <div class="item ${i.done?'done':''}">
                <input type="checkbox" ${i.done?'checked':''}
  onclick="toggleItem(${fi},${ri},${ii})">
                <span onclick="alert(i.path||'Í≤ΩÎ°ú ÏóÜÏùå')">${i.name}</span>
                <span class="tag ${TAG_CLASS[i.tag]}">${i.tag}</span>
                <button onclick="editItem(${fi},${ri},${ii})">‚úé</button>
                <button onclick="deleteItem(${fi},${ri},${ii})">üóë</button>
              </div>
            `).join('')}
            <div class="room-controls">
              <button onclick="addItem(${fi},${ri})">ÏïÑÏù¥ÌÖú Ï∂îÍ∞Ä</button>
              <button onclick="editRoom(${fi},${ri})">ÏàòÏ†ï</button>
              <button class="sub" onclick="deleteRoom(${fi},${ri})">ÏÇ≠Ï†ú</button>
            </div>
          </div>
        `).join('')}
      </div>
    `;
    fe.appendChild(d);
  });
}
render();
</script>
</body>
</html>