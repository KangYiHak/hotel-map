<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚˜í´ë¦¬íƒ„ í˜¸í…” | ìš´ì˜ì§„ ì¡°ì‚¬ ì§€ë„</title>

<style>
:root{
  --bg:#0b0b0d;
  --card:#141417;
  --accent:#d6b36a;
  --sub:#7d1c1c;
  --text:#f5f5f7;
  --muted:#9fa2b8;
  --line:#24242a;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,"Noto Sans KR",sans-serif;
}

header{
  padding:18px;
  text-align:center;
  border-bottom:1px solid var(--line);
}
header h1{margin:0;font-size:1.4rem}
header p{margin:6px 0 0;font-size:.85rem;color:var(--muted)}

main{max-width:900px;margin:auto;padding:16px}

/* ë²„íŠ¼ */
button{
  background:var(--accent);
  color:#000;
  border:none;
  border-radius:10px;
  padding:8px 12px;
  font-size:.75rem;
  cursor:pointer;
}
button.sub{background:var(--sub);color:#fff}
button.ghost{background:#222;color:#ccc}

/* íƒœê·¸ í•„í„° */
#tagBar{
  position:sticky;
  top:0;
  background:var(--bg);
  padding:10px 0;
  border-bottom:1px solid var(--line);
  z-index:5;
}
.tag{
  display:inline-block;
  padding:4px 8px;
  border-radius:999px;
  font-size:.65rem;
  background:#2a2a30;
  margin:2px;
  cursor:pointer;
}
.tag.active{background:var(--accent);color:#000}

/* ì¸µ */
.floor{
  background:var(--card);
  border-radius:16px;
  margin-bottom:14px;
  overflow:hidden;
}
.floor-header{
  padding:14px 16px;
  background:linear-gradient(135deg,#1a0f0f,var(--sub));
  cursor:pointer;
}
.floor-header h2{margin:0;font-size:1rem}
.floor-header p{margin:4px 0 0;font-size:.8rem;color:#ddd}

.floor-controls{
  padding:10px 16px;
  display:flex;
  gap:6px;
  flex-wrap:wrap;
}

.rooms{display:none;padding:0 16px 16px}

/* ê³µê°„ */
.room{
  background:#1b1212;
  border-radius:12px;
  padding:12px;
  margin-top:10px;
}
.room h3{margin:0;font-size:.9rem}
.room p{margin:4px 0;font-size:.75rem;color:var(--muted)}

.room-controls{
  display:flex;
  gap:6px;
  margin-top:8px;
  flex-wrap:wrap;
}

/* ì•„ì´í…œ */
.item{
  display:flex;
  align-items:center;
  gap:6px;
  font-size:.75rem;
  margin-top:6px;
}
.item.done{opacity:.4;text-decoration:line-through}

/* íŒì—… */
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.popup-content{
  background:var(--card);
  width:90%;
  max-width:420px;
  border-radius:16px;
  padding:16px;
}
.popup-content h3{margin-top:0}
.popup-content input,
.popup-content textarea{
  width:100%;
  background:#0f0f12;
  color:var(--text);
  border:1px solid var(--line);
  border-radius:8px;
  padding:8px;
  margin-bottom:8px;
  font-size:.75rem;
}
.close{float:right;cursor:pointer;color:var(--muted)}

@media(max-width:600px){
  button{width:100%}
  .floor-controls,.room-controls{flex-direction:column}
}
</style>
</head>

<body>

<header>
  <h1>NAPOLITAN HOTEL</h1>
  <p>ìš´ì˜ì§„ ì „ìš© ì¡°ì‚¬ ì§€ë„</p>
</header>

<main>

<div id="tagBar"></div>

<button onclick="addFloor()">â• ì¸µ ì¶”ê°€</button>
<div id="floors"></div>

</main>

<div class="popup" id="popup">
  <div class="popup-content">
    <span class="close" onclick="closePopup()">Ã—</span>
    <h3 id="popupTitle"></h3>
    <div id="popupBody"></div>
  </div>
</div>

<script>
let data = JSON.parse(localStorage.getItem('hotelData')) || [];
let activeTags=[];

function save(){localStorage.setItem('hotelData',JSON.stringify(data));}

function render(){
  floors.innerHTML='';
  const tagSet=new Set();

  data.forEach((f,fi)=>{
    const el=document.createElement('div');
    el.className='floor';
    el.innerHTML=`
      <div class="floor-header" onclick="toggleRooms(this)">
        <h2>${f.name}</h2>
        <p>${f.desc}</p>
      </div>
      <div class="floor-controls">
        <button onclick="moveFloor(${fi},-1)">â¬†</button>
        <button onclick="moveFloor(${fi},1)">â¬‡</button>
        <button onclick="editFloor(${fi})">ìˆ˜ì •</button>
        <button class="sub" onclick="deleteFloor(${fi})">ì‚­ì œ</button>
        <button onclick="addRoom(${fi})">ê³µê°„ ì¶”ê°€</button>
      </div>
      <div class="rooms"></div>
    `;

    const rooms=el.querySelector('.rooms');
    f.rooms.forEach((r,ri)=>{
      if(activeTags.length && !activeTags.some(t=>r.tags.includes(t))) return;
      r.tags.forEach(t=>tagSet.add(t));

      rooms.innerHTML+=`
        <div class="room">
          <h3>${r.name}</h3>
          <p>${r.desc}</p>
          <div class="tags">
            ${r.tags.map(t=>`<span class="tag ${activeTags.includes(t)?'active':''}" onclick="toggleTag('${t}')">${t}</span>`).join('')}
          </div>
          <div class="room-controls">
            <button onclick="openItems(${fi},${ri})">ğŸ“¦ ëª©ë¡</button>
            <button onclick="editRoom(${fi},${ri})">ìˆ˜ì •</button>
            <button class="sub" onclick="deleteRoom(${fi},${ri})">ì‚­ì œ</button>
          </div>
        </div>
      `;
    });

    floors.appendChild(el);
  });

  tagBar.innerHTML=[...tagSet].map(t=>`<span class="tag ${activeTags.includes(t)?'active':''}" onclick="toggleTag('${t}')">${t}</span>`).join('');
  save();
}

/* ì¸µ ì´ë™ */
function moveFloor(i,d){
  const n=i+d;
  if(n<0||n>=data.length)return;
  [data[i],data[n]]=[data[n],data[i]];
  render();
}

/* í† ê¸€ */
function toggleRooms(el){
  const r=el.parentElement.querySelector('.rooms');
  r.style.display=r.style.display==='block'?'none':'block';
}

/* íƒœê·¸ */
function toggleTag(t){
  activeTags.includes(t)?activeTags=activeTags.filter(x=>x!==t):activeTags.push(t);
  render();
}

/* CRUD */
function addFloor(){data.push({name:'ìƒˆ ì¸µ',desc:'í…Œë§ˆ',rooms:[]});render();}
function editFloor(i){
  popup('ì¸µ ìˆ˜ì •',`
    <input id="fn" value="${data[i].name}">
    <textarea id="fd">${data[i].desc}</textarea>
    <button onclick="saveFloor(${i})">ì €ì¥</button>
  `);
}
function saveFloor(i){data[i].name=fn.value;data[i].desc=fd.value;closePopup();render();}
function deleteFloor(i){if(confirm('ì‚­ì œ?')){data.splice(i,1);render();}}

function addRoom(fi){data[fi].rooms.push({name:'ìƒˆ ê³µê°„',desc:'ì„¤ëª…',tags:[],items:[]});render();}
function editRoom(fi,ri){
  const r=data[fi].rooms[ri];
  popup('ê³µê°„ ìˆ˜ì •',`
    <input id="rn" value="${r.name}">
    <textarea id="rd">${r.desc}</textarea>
    <input id="rt" value="${r.tags.join(',')}" placeholder="íƒœê·¸ ,ë¡œ êµ¬ë¶„">
    <button onclick="saveRoom(${fi},${ri})">ì €ì¥</button>
  `);
}
function saveRoom(fi,ri){
  const r=data[fi].rooms[ri];
  r.name=rn.value;r.desc=rd.value;
  r.tags=rt.value.split(',').map(t=>t.trim()).filter(Boolean);
  closePopup();render();
}
function deleteRoom(fi,ri){if(confirm('ì‚­ì œ?')){data[fi].rooms.splice(ri,1);render();}}

function openItems(fi,ri){
  const r=data[fi].rooms[ri];
  popup('ì•„ì´í…œ',`
    ${r.items.map((it,ii)=>`
      <div class="item ${it.done?'done':''}">
        <input type="checkbox" ${it.done?'checked':''} onchange="toggleItem(${fi},${ri},${ii})">
        <span onclick="editItem(${fi},${ri},${ii})">${it.name}</span>
      </div>`).join('')}
    <button onclick="addItem(${fi},${ri})">ì¶”ê°€</button>
  `);
}

function addItem(fi,ri){
  popup('ì•„ì´í…œ ì¶”ê°€',`
    <input id="inm" placeholder="ì´ë¦„">
    <textarea id="im" placeholder="íšë“ ê²½ë¡œ"></textarea>
    <button onclick="saveItem(${fi},${ri})">ì €ì¥</button>
  `);
}
function saveItem(fi,ri){
  data[fi].rooms[ri].items.push({name:inm.value,method:im.value,done:false});
  closePopup();render();
}
function editItem(fi,ri,ii){
  const it=data[fi].rooms[ri].items[ii];
  popup(it.name,`<textarea>${it.method}</textarea><button onclick="closePopup()">ë‹«ê¸°</button>`);
}
function toggleItem(fi,ri,ii){data[fi].rooms[ri].items[ii].done^=1;render();}

function popup(t,b){popupTitle.innerText=t;popupBody.innerHTML=b;popup.style.display='flex';}
function closePopup(){popup.style.display='none';}

render();
</script>
</body>
</html>

header{
  padding:16px;
  text-align:center;
  border-bottom:1px solid var(--line);
}
header h1{margin:0;font-size:1.4rem;letter-spacing:.04em}
header p{margin:6px 0 0;font-size:.8rem;color:var(--muted)}

main{max-width:900px;margin:auto;padding:14px}

/* ---------- ë²„íŠ¼ ---------- */
button{
  background:var(--accent);
  color:#000;
  border:none;
  border-radius:10px;
  padding:8px 12px;
  font-size:.75rem;
  cursor:pointer;
}
button.sub{background:var(--sub);color:#fff}
button.ghost{background:#222;color:#ccc}

/* ---------- íƒœê·¸ í•„í„° ---------- */
#tagBar{
  position:sticky;
  top:0;
  background:var(--bg);
  padding:10px 0;
  z-index:10;
  border-bottom:1px solid var(--line);
}
.tag{
  display:inline-block;
  padding:4px 8px;
  border-radius:999px;
  font-size:.65rem;
  background:#2a2a30;
  margin:2px;
  cursor:pointer;
}
.tag.active{background:var(--accent);color:#000}

/* ---------- ì¸µ ---------- */
.floor{
  background:var(--card);
  border-radius:16px;
  margin-bottom:14px;
  overflow:hidden;
}
.floor-header{
  padding:14px 16px;
  background:linear-gradient(135deg,#1b1111,var(--sub));
  display:flex;
  justify-content:space-between;
  align-items:center;
  cursor:pointer;
}
.floor-header h2{margin:0;font-size:.95rem}
.floor-header p{margin:4px 0 0;font-size:.75rem;color:#ddd}

.floor-header[draggable]{cursor:grab}

.floor-controls{
  padding:10px 16px;
  display:flex;
  gap:6px;
  flex-wrap:wrap;
}

.rooms{display:none;padding:0 16px 16px}

/* ---------- ê³µê°„ ---------- */
.room{
  background:#1c1c22;
  border-radius:12px;
  padding:12px;
  margin-top:10px;
}
.room h3{margin:0;font-size:.85rem}
.room p{margin:4px 0;font-size:.7rem;color:var(--muted)}

.room .tags{margin-top:6px}

.room-controls{
  display:flex;
  gap:6px;
  margin-top:8px;
  flex-wrap:wrap;
}

/* ---------- íŒì—… ---------- */
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.65);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.popup-content{
  background:var(--card);
  width:90%;
  max-width:420px;
  border-radius:18px;
  padding:16px;
}
.popup-content h3{margin:0 0 10px}
.popup-content input,
.popup-content textarea{
  width:100%;
  background:#0f0f14;
  color:var(--text);
  border:1px solid var(--line);
  border-radius:8px;
  padding:8px;
  font-size:.75rem;
  margin-bottom:8px;
}
.close{float:right;cursor:pointer;color:var(--muted)}

.item{
  display:flex;
  align-items:center;
  gap:6px;
  font-size:.75rem;
  margin:6px 0;
}
.item.done{opacity:.4;text-decoration:line-through}

/* ---------- ëª¨ë°”ì¼ ---------- */
@media(max-width:600px){
  button{width:100%}
  .floor-controls,.room-controls{flex-direction:column}
}
</style>
</head>

<body>

<header>
  <h1>NAPOLITAN HOTEL</h1>
  <p>ìš´ì˜ì§„ ì „ìš© ì¡°ì‚¬ ì§€ë„</p>
</header>

<main>

<div id="tagBar"></div>

<button onclick="addFloor()">â• ì¸µ ì¶”ê°€</button>
<div id="floors"></div>

</main>

<!-- íŒì—… -->
<div class="popup" id="popup">
  <div class="popup-content">
    <span class="close" onclick="closePopup()">Ã—</span>
    <h3 id="popupTitle"></h3>
    <div id="popupBody"></div>
  </div>
</div>

<script>
let data = JSON.parse(localStorage.getItem('hotelData')) || [];
let activeTags=[];
let dragIndex=null;

/* ---------- ì €ì¥/ë Œë” ---------- */
function save(){localStorage.setItem('hotelData',JSON.stringify(data));}

function render(){
  const wrap=floors; wrap.innerHTML='';
  const tags=new Set();

  data.forEach((f,fi)=>{
    const floor=document.createElement('div');
    floor.className='floor';

    floor.innerHTML=`
      <div class="floor-header" draggable="true"
        ondragstart="startDrag(event,${fi})"
        onclick="toggleRooms(this)">
        <div>
          <h2>${f.name}</h2>
          <p>${f.desc}</p>
        </div>
      </div>
      <div class="floor-controls">
        <button onclick="editFloor(${fi})">ìˆ˜ì •</button>
        <button class="sub" onclick="deleteFloor(${fi})">ì‚­ì œ</button>
        <button onclick="addRoom(${fi})">ê³µê°„ ì¶”ê°€</button>
      </div>
      <div class="rooms"></div>
    `;

    const rooms=floor.querySelector('.rooms');
    f.rooms.forEach((r,ri)=>{
      if(activeTags.length && !activeTags.some(t=>r.tags.includes(t))) return;

      r.tags.forEach(t=>tags.add(t));

      rooms.innerHTML+=`
        <div class="room">
          <h3>${r.name}</h3>
          <p>${r.desc}</p>
          <div class="tags">
            ${r.tags.map(t=>`<span class="tag ${activeTags.includes(t)?'active':''}" onclick="toggleTag('${t}')">${t}</span>`).join('')}
          </div>
          <div class="room-controls">
            <button onclick="openItemPopup(${fi},${ri})">ğŸ“¦ ëª©ë¡</button>
            <button onclick="editRoom(${fi},${ri})">ìˆ˜ì •</button>
            <button class="sub" onclick="deleteRoom(${fi},${ri})">ì‚­ì œ</button>
          </div>
        </div>`;
    });

    wrap.appendChild(floor);
  });

  tagBar.innerHTML=[...tags].map(t=>`<span class="tag ${activeTags.includes(t)?'active':''}" onclick="toggleTag('${t}')">${t}</span>`).join('');
  save();
}

/* ---------- íƒœê·¸ ---------- */
function toggleTag(t){
  activeTags.includes(t)?activeTags=activeTags.filter(x=>x!==t):activeTags.push(t);
  render();
}

/* ---------- ì¸µ ---------- */
function addFloor(){data.push({name:'ìƒˆ ì¸µ',desc:'í…Œë§ˆ',rooms:[]});render();}
function editFloor(i){
  popup('ì¸µ ìˆ˜ì •',`
    <input id="fn" value="${data[i].name}">
    <textarea id="fd">${data[i].desc}</textarea>
    <button onclick="saveFloor(${i})">ì €ì¥</button>`);
}
function saveFloor(i){data[i].name=fn.value;data[i].desc=fd.value;closePopup();render();}
function deleteFloor(i){if(confirm('ì‚­ì œ?')){data.splice(i,1);render();}}

/* ---------- ê³µê°„ ---------- */
function addRoom(fi){
  data[fi].rooms.push({name:'ìƒˆ ê³µê°„',desc:'ì„¤ëª…',tags:[],items:[]});
  render();
}
function editRoom(fi,ri){
  const r=data[fi].rooms[ri];
  popup('ê³µê°„ ìˆ˜ì •',`
    <input id="rn" value="${r.name}">
    <textarea id="rd">${r.desc}</textarea>
    <input id="rt" value="${r.tags.join(',')}" placeholder="íƒœê·¸ ,ë¡œ êµ¬ë¶„">
    <button onclick="saveRoom(${fi},${ri})">ì €ì¥</button>`);
}
function saveRoom(fi,ri){
  const r=data[fi].rooms[ri];
  r.name=rn.value; r.desc=rd.value;
  r.tags=rt.value.split(',').map(t=>t.trim()).filter(Boolean);
  closePopup();render();
}
function deleteRoom(fi,ri){if(confirm('ì‚­ì œ?')){data[fi].rooms.splice(ri,1);render();}}

/* ---------- ì•„ì´í…œ íŒì—… ---------- */
function openItemPopup(fi,ri){
  const r=data[fi].rooms[ri];
  popup(r.name+' ì•„ì´í…œ',`
    ${r.items.map((it,ii)=>`
      <div class="item ${it.done?'done':''}">
        <input type="checkbox" ${it.done?'checked':''} onchange="toggleItem(${fi},${ri},${ii})">
        <span onclick="editItem(${fi},${ri},${ii})">${it.name}</span>
      </div>`).join('')}
    <button onclick="addItem(${fi},${ri})">ì•„ì´í…œ ì¶”ê°€</button>`);
}

function addItem(fi,ri){
  popup('ì•„ì´í…œ ì¶”ê°€',`
    <input id="inm" placeholder="ì´ë¦„">
    <textarea id="im" placeholder="íšë“ ê²½ë¡œ"></textarea>
    <button onclick="saveItem(${fi},${ri})">ì¶”ê°€</button>`);
}
function saveItem(fi,ri){
  data[fi].rooms[ri].items.push({name:inm.value,method:im.value,done:false});
  closePopup();render();
}
function editItem(fi,ri,ii){
  const it=data[fi].rooms[ri].items[ii];
  popup(it.name,`
    <textarea id="im">${it.method}</textarea>
    <button onclick="closePopup()">ë‹«ê¸°</button>`);
}
function toggleItem(fi,ri,ii){
  data[fi].rooms[ri].items[ii].done^=1;
  render();
}

/* ---------- íŒì—… ---------- */
function popup(t,b){popupTitle.innerText=t;popupBody.innerHTML=b;popup.style.display='flex';}
function closePopup(){popup.style.display='none';}

/* ---------- í† ê¸€ ---------- */
function toggleRooms(el){
  const r=el.parentElement.querySelector('.rooms');
  r.style.display=r.style.display==='block'?'none':'block';
}

/* ---------- ë“œë˜ê·¸ ---------- */
function startDrag(e,i){
  if(e.target.tagName==='BUTTON') return e.preventDefault();
  dragIndex=i;
}
document.addEventListener('dragover',e=>e.preventDefault());
document.addEventListener('drop',e=>{
  const floor=e.target.closest('.floor');
  if(!floor||dragIndex===null)return;
  const to=[...floors.children].indexOf(floor);
  const moved=data.splice(dragIndex,1)[0];
  data.splice(to,0,moved);
  dragIndex=null;
  render();
});

render();
</script>
</body>
</html>
header{
  padding:18px;
  text-align:center;
  border-bottom:1px solid #222;
}
header h1{margin:0;font-size:1.4rem}
header p{margin:6px 0 0;color:var(--muted);font-size:.85rem}

main{max-width:900px;margin:0 auto;padding:16px}

/* ---------- ë²„íŠ¼ ---------- */
button{
  background:var(--accent);
  color:#000;
  border:none;
  border-radius:8px;
  padding:6px 10px;
  font-size:.75rem;
  cursor:pointer;
}
button.sub{background:var(--sub);color:#fff}
button.ghost{background:#222;color:#ccc}

/* ---------- ì¸µ ---------- */
.floor{
  background:var(--card);
  border-radius:14px;
  margin-bottom:14px;
  overflow:hidden;
  cursor:grab;
}
.floor.dragging{opacity:0.5;}
.floor-header{
  padding:14px 16px;
  background:linear-gradient(135deg,#1a0f0f,var(--sub));
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.floor-header h2{margin:0;font-size:1rem}
.floor-header p{margin:4px 0 0;font-size:.8rem;color:var(--muted)}

.floor-controls{
  display:flex;
  gap:6px;
  padding:10px 16px;
  flex-wrap:wrap;
}

.rooms{display:none;padding:10px 16px 16px;}

/* ---------- ê³µê°„ ---------- */
.room{
  background:#1b1212;
  border-radius:10px;
  padding:10px;
  margin-top:10px;
}
.room h3{margin:0;font-size:.9rem}
.room p{margin:4px 0 0;font-size:.75rem;color:var(--muted)}

.tags{margin-top:6px}
.tag{
  display:inline-block;
  font-size:.65rem;
  padding:2px 6px;
  border-radius:6px;
  background:#333;
  margin-right:4px;
  cursor:pointer;
}
.tag.active{background:var(--accent);color:#000;}

.room-controls{
  display:flex;
  gap:6px;
  margin-top:8px;
  flex-wrap:wrap;
}

/* ---------- ì•„ì´í…œ ---------- */
.item{
  display:flex;
  align-items:center;
  gap:6px;
  font-size:.75rem;
  margin-top:6px;
}
.item.done{opacity:.4;text-decoration:line-through}
.item input{cursor:pointer;}

/* ---------- íŒì—… ---------- */
.popup{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.popup-content{
  background:var(--card);
  width:90%;
  max-width:420px;
  border-radius:16px;
  padding:16px;
}
.popup-content h3{margin-top:0}
.popup-content input,
.popup-content textarea{
  width:100%;
  background:#0f0f12;
  color:var(--text);
  border:1px solid #333;
  border-radius:6px;
  padding:6px;
  margin-bottom:8px;
  font-size:.75rem;
}
.close{float:right;cursor:pointer;color:var(--muted);}

/* ---------- ëª¨ë°”ì¼ ---------- */
@media(max-width:600px){
  button{width:100%;padding:10px;font-size:.85rem;}
  .floor-controls,.room-controls{flex-direction:column;}
}
</style>
</head>

<body>
<header>
  <h1>NAPOLITAN HOTEL</h1>
  <p>ìš´ì˜ì§„ ì „ìš© ì¡°ì‚¬ ì§€ë„</p>
</header>

<main>
  <button onclick="addFloor()">â• ì¸µ ì¶”ê°€</button>
  <div id="floors"></div>

  <div style="margin-top:16px;">
    <label>íƒœê·¸ í•„í„°:</label>
    <div id="tagFilter"></div>
  </div>
</main>

<!-- íŒì—… -->
<div class="popup" id="popup">
  <div class="popup-content">
    <span class="close" onclick="closePopup()">Ã—</span>
    <h3 id="popupTitle"></h3>
    <div id="popupBody"></div>
  </div>
</div>

<script>
const popup = document.getElementById('popup');
const popupTitle = document.getElementById('popupTitle');
const popupBody = document.getElementById('popupBody');
let data = JSON.parse(localStorage.getItem('hotelData')) || [];
let activeTags = [];

function save(){ localStorage.setItem('hotelData', JSON.stringify(data)); }
function render(){
  const wrap = document.getElementById('floors');
  wrap.innerHTML = '';
  const tagsSet = new Set();

  data.forEach((f,fi)=>{
    const floor = document.createElement('div');
    floor.className='floor';
    floor.draggable=true;

    floor.innerHTML = `
      <div class="floor-header" onclick="toggleRooms(this)">
        <div>
          <h2>${f.name}</h2>
          <p>${f.desc}</p>
        </div>
      </div>
      <div class="floor-controls">
        <button onclick="editFloor(${fi})">ìˆ˜ì •</button>
        <button class="sub" onclick="deleteFloor(${fi})">ì‚­ì œ</button>
        <button onclick="addRoom(${fi})">ê³µê°„ ì¶”ê°€</button>
      </div>
      <div class="rooms"></div>
    `;

    const rooms = floor.querySelector('.rooms');
    f.rooms.forEach((r,ri)=>{
      const room = document.createElement('div');
      room.className='room';
      room.innerHTML = `
        <h3>${r.name}</h3>
        <p>${r.desc}</p>
        <div class="tags">
          ${r.tags.map(t=>`<span class="tag ${activeTags.includes(t)?'active':''}" onclick="toggleTag('${t}')">${t}</span>`).join('')}
        </div>
        <div>
          ${r.items.map((it,ii)=>`
            <div class="item ${it.done?'done':''}">
              <input type="checkbox" ${it.done?'checked':''} onchange="toggleItem(${fi},${ri},${ii})">
              <span onclick="editItem(${fi},${ri},${ii})">${it.name}</span>
            </div>`).join('')}
        </div>
        <div class="room-controls">
          <button onclick="addItem(${fi},${ri})">ì•„ì´í…œ ì¶”ê°€</button>
          <button onclick="editRoom(${fi},${ri})">ìˆ˜ì •</button>
          <button class="sub" onclick="deleteRoom(${fi},${ri})">ì‚­ì œ</button>
        </div>
      `;
      rooms.appendChild(room);
      r.tags.forEach(t=>tagsSet.add(t));
    });

    wrap.appendChild(floor);
  });

  renderTagFilter([...tagsSet].sort());
  save();
}

function renderTagFilter(tags){
  const f = document.getElementById('tagFilter');
  f.innerHTML = tags.map(t=>`<span class="tag ${activeTags.includes(t)?'active':''}" onclick="toggleTag('${t}')">${t}</span>`).join('');
}

function toggleTag(t){
  const idx = activeTags.indexOf(t);
  if(idx>-1) activeTags.splice(idx,1);
  else activeTags.push(t);
  render();
}

/* ---------- ì¸µ ---------- */
function addFloor(){
  data.push({name:'ìƒˆ ì¸µ',desc:'í…Œë§ˆ',rooms:[]});
  render();
}
function editFloor(i){
  popup('ì¸µ ìˆ˜ì •',`
    <input id="fn" value="${data[i].name}">
    <textarea id="fd">${data[i].desc}</textarea>
    <button onclick="saveFloor(${i})">ì €ì¥</button>
  `);
}
function saveFloor(i){
  data[i].name=fn.value;
  data[i].desc=fd.value;
  closePopup();render();
}
function deleteFloor(i){
  if(confirm('ì‚­ì œ?')){data.splice(i,1);render();}
}

/* ---------- ê³µê°„ ---------- */
function addRoom(fi){
  data[fi].rooms.push({name:'ìƒˆ ê³µê°„',desc:'ì„¤ëª…',tags:[],items:[]});
  render();
}
function editRoom(fi,ri){
  const r=data[fi].rooms[ri];
  popup('ê³µê°„ ìˆ˜ì •',`
    <input id="rn" value="${r.name}">
    <textarea id="rd">${r.desc}</textarea>
    <button onclick="saveRoom(${fi},${ri})">ì €ì¥</button>
  `);
}
function saveRoom(fi,ri){
  const r=data[fi].rooms[ri];
  r.name=rn.value;
  r.desc=rd.value;
  closePopup();render();
}
function deleteRoom(fi,ri){
  if(confirm('ì‚­ì œ?')){data[fi].rooms.splice(ri,1);render();}
}

/* ---------- ì•„ì´í…œ ---------- */
function addItem(fi,ri){
  popup('ì•„ì´í…œ ì¶”ê°€',`
    <input id="inm" placeholder="ì•„ì´í…œ ì´ë¦„">
    <textarea id="im" placeholder="íšë“ ê²½ë¡œ"></textarea>
    <button onclick="saveItem(${fi},${ri})">ì¶”ê°€</button>
  `);
}
function saveItem(fi,ri){
  data[fi].rooms[ri].items.push({
    name:inm.value,
    method:im.value,
    done:false
  });
  closePopup();render();
}
function editItem(fi,ri,ii){
  const it=data[fi].rooms[ri].items[ii];
  popup('ì•„ì´í…œ ìˆ˜ì •',`
    <input id="inm" value="${it.name}">
    <textarea id="im">${it.method}</textarea>
    <button onclick="saveEditedItem(${fi},${ri},${ii})">ì €ì¥</button>
  `);
}
function saveEditedItem(fi,ri,ii){
  const it=data[fi].rooms[ri].items[ii];
  it.name=inm.value;
  it.method=im.value;
  closePopup();render();
}
function toggleItem(fi,ri,ii){
  const it=data[fi].rooms[ri].items[ii];
  it.done=!it.done;
  render();
}

/* ---------- íŒì—… ---------- */
function popup(t,b){
  popupTitle.innerText=t;
  popupBody.innerHTML=b;
  popup.style.display='flex';
}
function closePopup(){ popup.style.display='none'; }

/* ---------- ê³µê°„ ëª©ë¡ ì—´ê¸°/ë‹«ê¸° ---------- */
function toggleRooms(el){
  // ë²„íŠ¼, ì…ë ¥ì°½ í´ë¦­ ì‹œ ì ‘í˜ ë°©ì§€
  if (
    event.target.tagName === 'BUTTON' ||
    event.target.tagName === 'INPUT' ||
    event.target.tagName === 'TEXTAREA'
  ) return;

  const rooms = el.parentElement.querySelector('.rooms');
  rooms.style.display =
    rooms.style.display === 'block' ? 'none' : 'block';
}

/* ---------- ë“œë˜ê·¸ ì¸µ ì´ë™ ---------- */
let dragSrc = null;
document.addEventListener('dragstart',e=>{
  if(e.target.classList.contains('floor')) dragSrc=e.target;
});
document.addEventListener('dragover',e=>{
  e.preventDefault();
  if(e.target.classList.contains('floor')){
    const bounding=e.target.getBoundingClientRect();
    const offset=e.clientY - bounding.top;
    if(offset>bounding.height/2) e.target.style.borderBottom='2px solid var(--accent)';
    else e.target.style.borderTop='2px solid var(--accent)';
  }
});
document.addEventListener('dragleave',e=>{
  if(e.target.classList.contains('floor')){
    e.target.style.borderTop='';
    e.target.style.borderBottom='';
  }
});
document.addEventListener('drop',e=>{
  e.preventDefault();
  if(dragSrc && e.target.classList.contains('floor')){
    const from = Array.from(dragSrc.parentElement.children).indexOf(dragSrc);
    const to = Array.from(e.target.parentElement.children).indexOf(e.target);
    if(from!==to){
      const moved = data.splice(from,1)[0];
      data.splice(to,0,moved);
      render();
    }
  }
  document.querySelectorAll('.floor').forEach(f=>{f.style.borderTop='';f.style.borderBottom='';});
});
render();
</script>
</body>
</html>