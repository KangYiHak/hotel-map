<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì¡°ì‚¬ ì‹œíŠ¸ (ìš´ì˜ì§„)</title>

<style>
:root{
  --bg:#0b0b10;
  --card:#14141c;
  --accent:#c93c3c;
  --sub:#5a6cff;
  --text:#eaeaf0;
  --muted:#8b8b9a;
  --lock:#444;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui, -apple-system, sans-serif;
  padding:14px;
}

button{
  background:var(--accent);
  color:#000;
  border:none;
  padding:8px 14px;
  border-radius:10px;
  font-size:.85rem;
  cursor:pointer;
}
button.sub{background:var(--sub); color:#fff}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:14px;
}
header h1{
  font-size:1.1rem;
  margin:0;
}

/* FLOOR */
.floor{
  background:var(--card);
  border-radius:16px;
  margin-bottom:14px;
  overflow:hidden;
}
.floor-header{
  padding:14px 16px;
  background:linear-gradient(135deg,#1a0f0f,var(--sub));
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.floor-header h2{
  margin:0;
  font-size:.95rem;
}
.floor-header .state{
  font-size:.7rem;
  color:#ddd;
  opacity:.8;
}
.floor.locked .floor-header{
  background:linear-gradient(135deg,#1a1a1a,#333);
}
.floor.locked .state{
  color:#aaa;
}

.rooms{
  display:none;
  padding:12px;
}
.floor.open .rooms{display:block}

/* ROOM */
.room{
  background:#1b1212;
  border-radius:12px;
  padding:12px;
  margin-bottom:8px;
}
.room-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.room h3{
  margin:0;
  font-size:.85rem;
}
.room p{
  margin:4px 0 0;
  font-size:.75rem;
  color:var(--muted);
}

.room.locked{
  background:#181818;
  opacity:.6;
}
.room.locked h3::after{
  content:" ğŸ”’";
}

/* DRAG */
.floor-header,
.room{
  touch-action:none;
}
.dragging{
  opacity:.4;
}

/* MOBILE */
@media (min-width:768px){
  body{max-width:720px;margin:auto}
}
</style>
</head>

<body>

<header>
  <h1>ğŸ¨ ì¡°ì‚¬ ì‹œíŠ¸ (ìš´ì˜ì§„)</h1>
  <button onclick="addFloor()">+ ì¸µ ì¶”ê°€</button>
</header>

<div id="floors"></div>

<script>
const floorsEl = document.getElementById("floors");

/* ===== FLOOR ===== */
function addFloor(){
  const floor = document.createElement("div");
  floor.className = "floor";
  floor.draggable = true;

  floor.innerHTML = `
    <div class="floor-header">
      <h2 contenteditable="true">ìƒˆë¡œìš´ ì¸µ</h2>
      <span class="state">ì—´ë¦¼</span>
    </div>
    <div class="rooms"></div>
  `;

  floorsEl.appendChild(floor);
  setupFloor(floor);
}

function setupFloor(floor){
  const header = floor.querySelector(".floor-header");
  const rooms = floor.querySelector(".rooms");

  header.onclick = () => {
    if(floor.classList.contains("locked")) return;
    floor.classList.toggle("open");
  };

  // floor drag
  floor.addEventListener("dragstart",()=>floor.classList.add("dragging"));
  floor.addEventListener("dragend",()=>floor.classList.remove("dragging"));

  floorsEl.addEventListener("dragover",e=>{
    e.preventDefault();
    const after = getDragAfter(floorsEl,e.clientY,".floor");
    const dragging = document.querySelector(".floor.dragging");
    if(!dragging) return;
    after ? floorsEl.insertBefore(dragging,after) : floorsEl.appendChild(dragging);
  });

  // ê¸°ë³¸ ë°©
  addRoom(rooms);
}

/* ===== ROOM ===== */
function addRoom(rooms){
  const room = document.createElement("div");
  room.className = "room";
  room.draggable = true;

  room.innerHTML = `
    <div class="room-header">
      <h3 contenteditable="true">ë°© ì´ë¦„</h3>
      <button class="sub" onclick="toggleLock(event,this)">ì ê¸ˆ</button>
    </div>
    <p contenteditable="true">ê°„ë‹¨í•œ ì„¤ëª…</p>
  `;

  rooms.appendChild(room);

  room.addEventListener("dragstart",()=>room.classList.add("dragging"));
  room.addEventListener("dragend",()=>room.classList.remove("dragging"));

  rooms.addEventListener("dragover",e=>{
    e.preventDefault();
    const after = getDragAfter(rooms,e.clientY,".room");
    const dragging = document.querySelector(".room.dragging");
    if(!dragging) return;
    after ? rooms.insertBefore(dragging,after) : rooms.appendChild(dragging);
  });
}

/* ===== LOCK ===== */
function toggleLock(e,btn){
  e.stopPropagation();
  const room = btn.closest(".room");
  room.classList.toggle("locked");
  btn.textContent = room.classList.contains("locked") ? "í•´ì œ" : "ì ê¸ˆ";
}

/* ===== DRAG UTIL ===== */
function getDragAfter(container,y,selector){
  const els = [...container.querySelectorAll(`${selector}:not(.dragging)`)];
  return els.reduce((closest,el)=>{
    const box = el.getBoundingClientRect();
    const offset = y - box.top - box.height/2;
    if(offset < 0 && offset > closest.offset){
      return {offset,element:el};
    }else{
      return closest;
    }
  },{offset:Number.NEGATIVE_INFINITY}).element;
}

/* init */
addFloor();
</script>

</body>
</html>